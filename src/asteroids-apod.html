<template>
  <style>
    :host {
      contain: content;
    }

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: var(--asteroids-apod-transition, 250ms ease);
    }

    .opaque {
      opacity: 1;
    }
  </style>
  <img src="" alt="NASA's Picture of the Day" />
</template>

<script>
  (function(ownerDocument) {
    class AsteroidsApod extends HTMLElement {
      constructor() {
        super();

        const shadowRoot = this.attachShadow({ mode: 'open' });
        const template = ownerDocument.querySelector('template');
        const instance = template.content.cloneNode(true);

        shadowRoot.appendChild(instance);

        this.addEventListener('click', e => console.log(e));
      }

      connectedCallback() {
        const img = this.shadowRoot.querySelector('img');

        fetch(`https://api.nasa.gov/planetary/apod?api_key=lNMbOmip78PkrKx5w0VAjKIIAB2zAAGca8DXk2c6`)
          .then(res => res.json())
          .then(res => {
            img.setAttribute('src', res.hdurl);
            img.addEventListener('load', function() {
              this.classList.add('opaque');
            })
          });
      }
    }

    window.customElements.define('asteroids-apod', AsteroidsApod);
  }(document.currentScript.ownerDocument))
</script>
